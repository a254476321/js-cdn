let c2s=689,s2c=690;function encode(b){let c="";for(let a in b){c+=a+"@="+b[a]+"/"}return new Uint8Array([9+c.length,0,0,0,9+c.length,0,0,0,c2s&255,c2s>>8,0,0,...putString(c),0]).buffer}function decode(e){let a=decodeRaw(e).split("/"),c={},d;for(let b=0,f=a.length-1;b<f;++b){d=a[b].split("@=");c[d[0]]=d[1]}return c}function decodeRaw(a){return(a[0]^a[4]|a[1]^a[5]|a[2]^a[6]|a[3]^a[7]|a[10]|a[11])!=0||(a[9]<<8|a[8])!=s2c?"":(new TextDecoder).decode(a.slice(12))}function uint(a){let c=0;for(let b=a.length-1;b>=0;--b){c=c<<8|a[b]}return c}function putString(a){let c=[];for(let b=0,d=a.length;b<d;++b){c[b]=a.charCodeAt(b)}return c}function start(){ws=new WebSocket("wss://danmuproxy.douyu.com:8501/");ws.onopen=()=>{ws.send(encode({"type":"loginreq","roomid":R}));ws.send(encode({"type":"joingroup","rid":R,"gid":"-9999"}));ws.send(encode({"type":"mrkl"}));alive=setInterval(()=>{ws.send(encode({"type":"mrkl"}))},30000)};ws.onclose=close;ws.onerror=a=>{close();console.error(a)};ws.onmessage=b=>{if(document.hidden){return}let a=new FileReader;a.readAsArrayBuffer(b.data);a.onload=()=>{let d=new Uint8Array(a.result),c;for(let e=0,f=d.length;e<f;e+=c){c=uint(d.slice(e,e+4))+4,data=decode(d.slice(e,e+c));handle(data)}}}}function close(){clearInterval(alive);if(ws){ws.send(encode({"type":"logout"}));ws.close()}}function handle(a){if("chatmsg"==a.type&&parseInt(a.level)>=ML){player.insert({value:a.txt,opacity:0.9,fontWeight:"bold"})}};