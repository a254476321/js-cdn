let c2s=689,s2c=690,textDecoder=new TextDecoder,textEncode=new TextEncoder;function encode(c){let d="",b;for(let a in c){d+=a+"@="+c[a]+"/"}return b=new Uint8Array(13+d.length),b[0]=b[4]=9+d.length,b[8]=c2s&255,b[9]=c2s>>8,b.set(textEncode.encode(d),12),b.buffer}function decode(e){let a=decodeRaw(e).split("/"),c={},d;for(let b=0,f=a.length-1;b<f;++b){d=a[b].split("@=");c[d[0]]=d[1].replace("@A","@").replace("@S","/")}return c}function decodeRaw(a){return(a[0]^a[4]|a[1]^a[5]|a[2]^a[6]|a[3]^a[7]|a[10]|a[11])!=0||(a[9]<<8|a[8])!=s2c?"":textDecoder.decode(a.subarray(12,-1))}function uint(a){let c=0;for(let b=a.length-1;b>=0;--b){c=c<<8|a[b]}return c}function start(){ws=new WebSocket("wss://danmuproxy.douyu.com:8501/");ws.onopen=()=>{ws.send(encode({"type":"loginreq","roomid":R}));ws.send(encode({"type":"joingroup","rid":R,"gid":"-9999"}));ws.send(encode({"type":"mrkl"}));alive=setInterval(()=>{ws.send(encode({"type":"mrkl"}))},30000)};ws.onclose=close;ws.onerror=a=>{close();console.error(a)};ws.onmessage=b=>{if(document.hidden){return}let a=new FileReader;a.readAsArrayBuffer(b.data);a.onload=()=>{let d=new Uint8Array(a.result),c;for(let e=0,f=d.length;e<f;e+=c){c=uint(d.subarray(e,e+4))+4,data=decode(d.subarray(e,e+c));handle(data)}}}}function close(){clearInterval(alive);if(ws){ws.send(encode({"type":"logout"}));ws.close()}}function handle(a){if("chatmsg"==a.type&&parseInt(a.level)>=ML){player.insert({value:a.txt,opacity:0.9,fontWeight:"bold"})}};